<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=3" />
    <link rel="icon" type="image/png" href="/workerfacts-logo.png?v=3" />
    <link rel="apple-touch-icon" href="/workerfacts-logo.png?v=3" />
    <link rel="shortcut icon" href="/favicon.ico?v=3" />
    <link rel="manifest" href="/manifest.json" />
    <meta
      name="description"
      content="The industry's most advanced web-based platform for clinical abilities determination"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black" />
    <meta name="apple-mobile-web-app-title" content="WorkerFacts" />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: light)"
      content="#7dacdb"
    />
    <meta
      name="theme-color"
      media="(prefers-color-scheme: dark)"
      content="#7dacdb"
    />
    <meta
      property="og:title"
      content="Functional Capacity Evaluation Software"
    />
    <meta
      property="og:description"
      content="The industry's most advanced web-based platform for clinical abilities determination"
    />
    <meta
      name="twitter:title"
      content="Functional Capacity Evaluation Software"
    />
    <meta
      name="twitter:description"
      content="The industry's most advanced web-based platform for clinical abilities determination"
    />
    <meta name="twitter:card" content="summary_large_image" />
    <title>WorkerFacts</title>
  </head>

  <body>
    <div id="root"></div>

    <script type="module" src="/client/App.tsx"></script>

    <!-- Service Worker Registration -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log(
                "[ServiceWorker] Registration successful:",
                registration.scope,
              );

              // Check for updates
              registration.addEventListener("updatefound", () => {
                const newWorker = registration.installing;
                if (newWorker) {
                  newWorker.addEventListener("statechange", () => {
                    if (
                      newWorker.state === "installed" &&
                      navigator.serviceWorker.controller
                    ) {
                      // New content is available, show update notification
                      console.log(
                        "[ServiceWorker] New content available, please refresh.",
                      );
                      if (
                        confirm(
                          "New version available. Refresh page to update?",
                        )
                      ) {
                        window.location.reload();
                      }
                    }
                  });
                }
              });
            })
            .catch((error) => {
              console.log("[ServiceWorker] Registration failed:", error);
            });
        });

        // Listen for service worker messages
        navigator.serviceWorker.addEventListener("message", (event) => {
          if (event.data && event.data.type === "CACHE_STATUS") {
            console.log("[ServiceWorker] Cache status:", event.data);
          }
        });

        // Handle offline/online events
        window.addEventListener("online", () => {
          console.log("[Network] Back online");
          document.body.classList.remove("offline");
        });

        window.addEventListener("offline", () => {
          console.log("[Network] Gone offline");
          document.body.classList.add("offline");
        });
      }
    </script>
  </body>
</html>
